# 快速开始指南

本指南目标：先把「决策 → 风控 → 落盘历史」整条链路跑通，再逐步切换到在线行情/回测/模拟盘。

---

## 0. 安装与配置

1. 安装依赖：`pip install -r requirements.txt`
2. 配置（可选）：复制 `.env.example` 为 `.env`
   - 离线模式不需要填写 Key
   - 在线模式至少需要 `DEEPSEEK_API_KEY`；如需 OKX 实时行情则填写 `OKX_*`

---

## 1. 先跑通离线决策（不调用 LLM / OKX）

```bash
python run_decision.py --offline --save-output
```

你会在以下位置看到结果：

- `output/decision.json`、`output/risk_report.json`
- `output/history/<run_id>/`（完整留痕：prompt、快照、决策、风控、raw 响应等）

---

## 2. 准备数据库行情（用于技术分析/回测/模拟盘）

技术分析 Agent 默认从 SQLite（`data/market_data.db`）读取最近 N 根 K 线，并已接入：
- CLI：`run_decision.py`
- API：`api/routes.py` 的 `/api/decision/run`

首次同步示例（回测通常需要 15m 数据）：

```bash
python update_market_data.py --initial-sync --timeframe 15m --days 365
python update_market_data.py --stats
```

如果数据库没有数据或生成失败，决策流程会降级为“不带技术分析”继续执行（不会阻塞主流程）。

---

## 3. 在线决策（DeepSeek + OKX 行情）

```bash
python run_decision.py --live-market --save-output
```

可选参数：

- `--timeframe 15m|1h|4h`
- `--symbol BTC`
- `--strategy conservative|balanced|aggressive`

---

## 4. Web 仪表盘

```bash
uvicorn fastapi_app:app --reload
```

打开：`http://127.0.0.1:8000/`

---

## 5. 回测与模拟盘

- 回测：`python run_backtest.py --config backtest_config.yaml --output-dir output/backtest`
- 模拟盘：`python run_paper_trading.py --config backtest_config.yaml`

---

## 6. 常见自定义入口

- 调整 Prompt：`src/prompts/decision_prompt.py`
- 调整技术分析报告：`src/data/technical_analysis_agent.py`
- 调整策略与风险预设：`src/strategies.py`、`src/config.py`

---

## 7. 旧 CSV 示例（可选）

如果你想做纯离线 CSV 技术分析实验（与当前 DB 版 Agent 不同）：

- 数据：`datasets/BTCUSDT-1h-merged2.csv`
- 脚本：`examples/技术分析Agent示例_csv.py`

