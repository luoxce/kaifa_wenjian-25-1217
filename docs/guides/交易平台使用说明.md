# 交易平台Web界面使用说明

## 概述

交易平台Web界面是一个类似币安风格的完整交易系统，集成了回测、模拟盘和实盘交易功能。

## 访问方式

1. 启动FastAPI服务器：
   ```bash
   uvicorn fastapi_app:app --reload
   ```

2. 在浏览器中访问：
   - 主页：http://localhost:8000
   - 交易平台：http://localhost:8000/trading

## 功能模块

### 1. 模式切换

顶部导航栏提供三种模式切换：

- **回测模式**：使用历史数据进行策略回测
- **模拟盘模式**：使用虚拟资金进行实时模拟交易
- **实盘模式**：连接真实OKX交易所进行真实交易（需要API密钥）

### 2. K线图表

- 支持多时间框架：15m、1h、4h、1d
- 实时价格显示
- 技术指标支持（EMA、RSI、MACD等）
- 缩放和平移功能

### 3. 订单簿

- 实时显示买卖盘深度
- 价格、数量、累计量
- 自动刷新（每3秒）

### 4. 回测控制面板

**功能**：
- 日期范围选择（开始日期、结束日期）
- 初始资金设置
- 策略选择（保守/平衡/激进）
- 杠杆上限配置
- 运行回测并查看结果

**使用步骤**：
1. 选择"回测"模式
2. 设置回测参数
3. 点击"运行回测"
4. 查看结果（总收益、交易次数、详细报告链接）

### 5. 模拟盘控制面板

**功能**：
- 设置初始资金
- 启动/停止模拟盘
- 查看账户状态（权益、可用资金、交易次数）
- 自动更新（每5秒）

**使用步骤**：
1. 选择"模拟盘"模式
2. 设置初始资金
3. 点击"启动模拟盘"
4. 系统会自动每15分钟执行一次交易决策
5. 实时查看账户状态和持仓

### 6. 实盘交易面板

**功能**：
- 下单表单（方向、数量、价格、杠杆）
- 市价单/限价单选择
- 订单确认机制
- 风险提示

**使用步骤**：
1. 选择"实盘"模式
2. 确保已配置OKX API密钥
3. 填写下单信息
4. 确认下单（需要二次确认）
5. 查看订单状态

**⚠️ 重要提示**：
- 实盘交易有真实资金风险
- 所有操作需要二次确认
- 建议先在模拟盘测试策略

### 7. 持仓列表

显示当前所有持仓：
- 交易对、方向（做多/做空）
- 数量、杠杆
- 开仓价、标记价
- 未实现盈亏（实时更新）

### 8. 订单历史

显示最近的订单记录：
- 订单ID、交易对
- 方向、数量、价格
- 订单状态（已成交/待成交/已撤销）

## API端点

### 市场数据
- `GET /api/market/orderbook?symbol=BTC&limit=20` - 获取订单簿
- `GET /api/market/trades?symbol=BTC&limit=50` - 获取最近成交
- `GET /api/database/candles?symbol=BTC&timeframe=1h&limit=500` - 获取K线数据

### 回测
- `POST /api/backtest/run` - 运行回测
- `GET /api/backtest/list` - 获取回测历史列表
- `GET /api/backtest/results/{run_id}` - 获取回测结果详情

### 模拟盘
- `POST /api/paper_trading/start` - 启动模拟盘
- `POST /api/paper_trading/stop` - 停止模拟盘
- `GET /api/paper_trading/status` - 获取模拟盘状态
- `GET /api/paper_trading/account` - 获取模拟盘账户详情

### 实盘交易
- `POST /api/real_trading/order` - 下单
- `GET /api/real_trading/account` - 获取实盘账户信息
- `POST /api/real_trading/cancel?order_id=xxx&symbol=BTC` - 撤单

## 配置要求

### 回测模式
- 需要15分钟历史数据（至少100根1H K线）
- 运行命令：`python update_market_data.py --initial-sync --timeframe 15m --days 365`

### 模拟盘模式
- 需要实时市场数据
- 需要配置DeepSeek API密钥（用于LLM决策）

### 实盘模式
- 需要配置OKX API密钥（`.env`文件）：
  ```
  OKX_API_KEY=your_api_key
  OKX_API_SECRET=your_api_secret
  OKX_PASSWORD=your_passphrase
  ```
- 需要配置DeepSeek API密钥

## 界面布局

```
┌─────────────────────────────────────────────────────────┐
│  顶部导航：模式切换 | 账户信息 | 刷新按钮                │
├──────────┬──────────────────────────┬───────────────────┤
│          │                          │                   │
│ 交易对   │      K线图表区域          │  订单簿           │
│ 列表     │      (15m/1h/4h/1d)      │  下单面板         │
│          │                          │                   │
├──────────┴──────────────────────────┴───────────────────┤
│  持仓列表  │  订单历史  │  控制面板                      │
└─────────────────────────────────────────────────────────┘
```

## 使用流程示例

### 回测流程
1. 访问 http://localhost:8000/trading
2. 点击"回测"模式
3. 设置日期范围（如：2024-11-01 到 2024-12-01）
4. 设置初始资金和策略
5. 点击"运行回测"
6. 等待回测完成（可能需要几分钟）
7. 查看结果和详细报告

### 模拟盘流程
1. 点击"模拟盘"模式
2. 设置初始资金（如：10000）
3. 点击"启动模拟盘"
4. 系统自动运行，每15分钟执行一次决策
5. 实时查看账户状态和持仓变化

### 实盘交易流程
1. 确保已配置OKX API密钥
2. 点击"实盘"模式
3. 查看账户余额和持仓
4. 填写下单信息
5. 确认下单（二次确认）
6. 查看订单状态和历史

## 注意事项

1. **数据要求**：
   - 回测需要至少100根1H K线（约4-5天数据）
   - 建议下载365天的15m数据以确保技术指标准确

2. **API限制**：
   - OKX API有速率限制，避免频繁请求
   - DeepSeek API调用会产生费用

3. **实盘交易风险**：
   - 所有实盘操作需要二次确认
   - 建议先在模拟盘充分测试
   - 设置合理的止损和止盈

4. **浏览器兼容性**：
   - 推荐使用Chrome、Firefox或Edge
   - 确保JavaScript已启用

## 故障排除

### 问题：K线图表不显示
- 检查数据库是否有数据：`python update_market_data.py --stats`
- 检查浏览器控制台是否有错误
- 确保Lightweight Charts库已加载

### 问题：订单簿不更新
- 检查网络连接
- 检查OKX API配置
- 查看浏览器控制台错误信息

### 问题：回测失败
- 确保有足够的15m历史数据
- 检查回测日期范围是否合理
- 查看服务器日志了解详细错误

### 问题：实盘下单失败
- 检查OKX API密钥配置
- 检查账户余额是否充足
- 查看风控检查是否通过
- 检查订单参数是否合理

## 下一步优化

- WebSocket实时数据推送
- 更多技术指标显示
- 交易策略参数优化
- 回测结果可视化图表
- 移动端适配

