# 比特币合约交易策略库 - v2.0 核心版

> **版本**: v2.0  
> **更新日期**: 2026-01-17  
> **适用市场**: 比特币 (BTC) 永续合约  
> **核心目标**: 聚焦于趋势跟踪、网格交易与突破策略的实战落地

---

## 修订说明 (v2.0)

本次更新是基于 v1.0 版本的精炼和聚焦，旨在为开发者提供一个更清晰、更具可操作性的实施蓝图。核心变化如下：

1.  **明确核心策略**: 根据项目初期目标，文档内容将重点围绕 **趋势跟踪**、**网格交易** 和 **突破策略** 三大核心进行详细阐述。
2.  **简化次要策略**: 将其他策略（如动量、均值回归、链上信号等）移至附录，作为未来的扩展方向，避免初期开发分散精力。
3.  **强化合约特性**: 更加突出 **资金费率**、**杠杆风险** 和 **强制平仓** 等合约交易的核心要素，并将其融入策略设计和风险管理中。
4.  **聚焦开发者需求**: 删减了部分宽泛的理论，强化了可直接用于编码的 **策略参数**、**风控规则** 和 **伪代码**，与您提出的开发问题直接对应。

---

## 1. 核心理念：从宏观到微观的系统化交易

成功的量化交易并非依赖单一“神奇”策略，而是一个系统工程。我们的框架遵循自顶向下的设计：

1.  **市场状态识别 (Regime Filter)**: 首先判断市场处于 **趋势**、**震荡** 还是 **突破前夕**。这是所有决策的起点。
2.  **全局风险管理 (Global Risk Engine)**: 在任何操作之前，全局风控层将检查最大亏损、总敞口等红线，确保系统安全。
3.  **策略选择与执行 (Strategy Orchestrator)**: 根据市场状态，选择并激活最合适的策略模块（趋势、网格或突破）。
4.  **仓位与风险计算 (Position Sizing)**: 每个策略的仓位大小不再是固定值，而是根据 **止损距离** 和 **单笔风险敞口** 动态计算得出。

---

## 2. 市场状态识别 (Regime Filter)

我们采用一套简洁有效的指标组合来划分市场状态：

| 市场状态 | 核心判断指标 | 规则示例 (4h 周期) |
|---|---|---|
| **趋势 (TREND)** | ADX(14) > 20 且 EMA(55) 斜率明确 | 当市场出现明显方向性时，启用趋势跟踪策略。 |
| **震荡 (RANGE)** | ADX(14) < 18 且布林带宽度 (BBW) 稳定或收缩 | 当市场横盘整理时，启用网格交易策略。 |
| **突破 (BREAKOUT)** | 布林带宽度处于近期低位 (挤压) + 价格接近关键位 | 当市场波动率压缩至极点，预示大行情将至，准备启用突破策略。|

---

## 3. 全局风险管理 (Global Risk Engine)

这是系统的“安全带”，所有策略必须遵守。核心规则如下：

*   **单笔风险上限**: `risk_per_trade_pct = 1%` (单笔交易最大亏损不超过总权益的 1%)。
*   **总杠杆上限**: `max_leverage = 3x` (即使多个策略叠加，总杠杆也不超过 3 倍)。
*   **单品种持仓唯一性**: `max_positions_per_symbol = 1` (为避免策略冲突，同一时间 BTC/USDT 只允许一个策略持仓)。
*   **每日亏损熔断**: `max_daily_loss_pct = -3%` (当日总亏损达到 3%，系统将停止所有新开仓活动)。

---

## 4. 核心策略详解

### 策略一：趋势跟踪 (Trend Following)

**理念**: 顺势而为，在趋势明确时入场，并尽可能让利润奔跑。

*   **适用场景**: **TREND** 市场状态。
*   **时间框架**: 4h, 1d。

| 环节 | 规则描述 |
|---|---|
| **入场 (做多)** | 1. EMA(9) > EMA(21) > EMA(55) 形成标准多头排列。<br>2. 价格回调至 EMA(9) 附近获得支撑。<br>3. MACD 柱状图在零轴上方，且连续 2 根放大。<br>4. **过滤**: 价格离 EMA(21) 的距离不超过 1.5 倍 ATR(14)，避免追高。 |
| **出场** | 1. **止盈**: 不设固定止盈，采用移动止损（如追踪 K 线高点下方 2 倍 ATR）。<br>2. **止损**: 初始止损设置在入场点下方 2 倍 ATR(14) 处。<br>3. **结构破坏**: 当价格收盘跌破 EMA(21) 时，视为趋势可能转弱，主动平仓。 |
| **仓位计算** | `仓位大小 = (总权益 * risk_per_trade_pct) / (入场价 - 止损价)` |
| **合约特性考量** | 在强趋势中，若资金费率为负（对多头有利），可适当放大风险敞口；若为正且过高，则应降低仓位，因为资金费率是持仓成本。 |

### 策略二：网格交易 (Grid Trading)

**理念**: 在震荡行情中，通过低买高卖反复获利。这是典型的“均值回归”思想。

*   **适用场景**: **RANGE** 市场状态，且波动率不能过高。
*   **时间框架**: 1h, 4h。

| 环节 | 规则描述 |
|---|---|
| **网格设定** | 1. **区间**: 以过去 120 根 K 线 (4h周期下为20天) 的高低点作为初始网格的上下轨。<br>2. **格数**: 10-20 格。<br>3. **间距**: 等差或等比，等比在价格较高时更优。 |
| **执行逻辑** | 价格每下跌一格，买入一份；每上涨一格，卖出一份。 |
| **风险管理** | 1. **强制退出 (核心)**: 一旦市场状态从 **RANGE** 切换为 **TREND** (例如 ADX > 20)，立即停止网格并全部平仓止损。这是网格策略的生命线。<br>2. **总止损**: 当价格跌破网格下轨并低于 1.5 倍 ATR(14) 时，清仓所有头寸。<br>3. **资金占用**: 网格策略资金占用较高，总投入不应超过总权益的 30%。 |
| **合约特性考量** | 杠杆会急剧增加网格策略在单边行情中的爆仓风险。**强烈建议网格策略使用 1x 杠杆**，或严格控制总仓位价值。 |

### 策略三：突破策略 (Breakout Strategy)

**理念**: 在市场长期盘整、波动率压缩后，捕捉价格突破关键阻力/支撑位的大行情。

*   **适用场景**: **BREAKOUT** 市场状态。
*   **时间框架**: 4h, 1d。

| 环节 | 规则描述 |
|---|---|
| **入场 (做多)** | 1. **前提**: 布林带宽度 (BBW) 处于过去 100 根 K 线的 20% 分位数以下 (极度压缩)。<br>2. **突破**: 价格以一根实体饱满的阳线收盘于关键阻力位上方。<br>3. **确认**: 成交量 > 过去 20 根 K 线均量的 1.5 倍。<br>4. **假突破过滤**: 入场后，若价格在 3 根 K 线内又收盘跌回阻力位下方，则立即退出。 |
| **出场** | 1. **止盈**: 突破后的第一目标位通常是前一震荡区间的宽度的一倍或两倍。<br>2. **止损**: 设置在被突破的阻力位下方，并结合 ATR 给予一定缓冲空间，例如 `止损价 = 阻力位 - 1.5 * ATR(14)`。 |
| **仓位计算** | 与趋势策略类似，根据止损距离反推仓位。 |
| **合约特性考量** | 突破通常伴随高滑点。在实盘中，应使用市价单以确保成交，但需在回测中模拟滑点成本。突破失败的风险很高，因此“假突破过滤”规则至关重要。 |

---

## 5. 给开发者的建议与配置模板

基于我们之前的沟通，以下是建议的 V1 版本启用配置，可直接用于您的系统开发。

```json
{
  "global": {
    "symbol": "BTC/USDT:USDT",
    "risk": {
      "risk_per_trade_pct": 0.01,
      "max_leverage": 3,
      "max_positions_per_symbol": 1,
      "max_daily_loss_pct": 0.03
    }
  },
  "regime": {
    "trend_adx_on": 20,
    "range_adx_off": 18,
    "breakout_bbw_percentile": 0.2
  },
  "strategies": {
    "ema_trend": {
      "enabled": true,
      "timeframe": "4h",
      "ema_periods": [9, 21, 55],
      "stop_loss_atr": 2.0,
      "trailing_stop_atr": 2.0
    },
    "grid_trading": {
      "enabled": true,
      "timeframe": "4h",
      "range_lookback_bars": 120,
      "grid_count": 15,
      "stop_loss_atr_outside_range": 1.5,
      "kill_switch_on_trend_detected": true
    },
    "breakout": {
      "enabled": true,
      "timeframe": "4h",
      "volume_multiplier": 1.5,
      "stop_loss_atr_below_level": 1.5,
      "fake_breakout_exit_bars": 3
    }
  }
}
```

---

## 附录：待选策略库 (Backlog)

以下策略在 v1.0 中有详细描述，但在当前阶段作为备选，待核心功能稳定后再考虑引入。

*   **资金费率套利**: 风险较低，但需要现货对冲，操作链路更复杂。
*   **动量交易**: 适合极端情绪行情，但风险高，回撤大。
*   **均值回归 (RSI/布林带)**: 可被网格策略部分替代，优先级较低。
*   **链上信号策略**: 数据源依赖性强，需要额外的数据工程。
*   **时间周期策略**: 规律的统计显著性需要持续验证。

**文档结束**
